<h1>Liste des utilisateurs</h1>
<%= link_to_beneficiaires %> / <%= link_to_ingenieurs %><br/><br/>
<%= link_to 'Ajouter un utilisateur', :action => 'signup' %> / <%= link_to 'Ajouter plusieurs utilisateurs', :action => 'multiple_signup' %> / <%= link_to_export( :data => 'identifiants') %>
<br/><br/>

<% if @ingenieur %>
 <% form_tag :action => "devenir" do %>
   <select id="account_beneficiaire_id" name="account[beneficiaire_id]">
     <%= option_groups_from_collection_for_select(@clients, "beneficiaires",
                                                  "nom", "id", "nom" ) %>
   </select>
   <%= submit_tag "Devenir" %><br />
 <% end %>
<% end %>

<%= show_pages_links(@user_pages, 'un nouvel utilisateur') %>


<table>
  <tr>
    <th>Identifiant <%= select_filter(@all_users, 'identifiant', :title => 'Identifiant') %></th>
  <% for role in Role.find_all %>
    <th><small> [<%= link_to role.nom, :controller => 'roles', :action => 'edit', :id => role %>] </small></th>
  <% end %>
    <th>Ingénieur</th>
    <th>Bénéficiaire</th>
    <th>Mail</th>
    <th>T&eacute;l&eacute;phone</th>
    <th>(Client)</th>
    <th></th>
  </tr>

  <% @users.each_index {|i| %>
   <% user = @users[i] %>
   <%= "<tr class=\"#{(i % 2)==0 ? 'pair':'impair'}\">" %>

     <td><%=h user.login %></td>
     <td colspan="4">
      <% form_tag({:action => 'update', :id => user}, {:name => 'form_'+user.id.to_s}) do%> 
         <% for role in Role.find_all %>
           &nbsp;&nbsp;<input type="radio" id="<%=role.id%>" name="role_ids[]" value="<%=role.id%>"
           <%if user.roles.include? role%> checked="checked" <%end%> >&nbsp;&nbsp;
         <% end %>
         <% end %></td>
      <td><%= "X" if user.ingenieur %></td>
      <td><%= "X" if user.beneficiaire %>
          <%= "Permissions anormales" unless user.valide %></td>
      <td><%= mail_to user.email, user.email %></td>
      <td><%= user.telephone %></td>
      <td><%= user.beneficiaire.client.nom if user.beneficiaire %></td>
      <td><a onclick="document.forms['form_<%= user.id.to_s  %>'].submit()"><b>Valider</b></a></td>


    <td><%= link_to_view user %></td>
    <td><%= link_to_edit user %></td>
   </tr>
  <% } %>
</table>


<%= show_pages_links(@user_pages, 'un nouvel utilisateur') %><br/>

<%= link_to 'Ajouter un utilisateur', :action => 'signup' %><br/>
<%= link_to 'Ajouter plusieurs utilisateurs', :action => 'multiple_signup' %><br/>
<%= link_to_export( :data => 'identifiants') %>
