<% cache("requests/#{@request.id}/info-#{session[:user].kind}") do %>
<%= div_toogle _('Action'), 'menu_action', :class => 'menu_title' %>
<ul id="menu_action">
  <% if @ingenieur %>
    <% options = { :logiciel_id => @request.logiciel_id, :request_id => @request.id } %>
    <li><%=link_to_new_contribution(_('Add a contribution'), options )%></li>
    <li><%= _('Link to a contribution')%><br />
        <% form_tag link_contribution_request_path(@request.id) do %>
      <%= select_onchange @contributions, 'request', 'contribution_id' %>
    <% end %></li>
    <% if @request.contribution %>
       <li><%= link_to_unlink_contribution(@request.id) %></li>
    <% end %>
    <li><%= link_to_add_call @request.id %></li>
  <% end %>
  <li><%= link_to _("Print"), print_request_path(@request.id),
            :target => '_blank' %></li>
</ul>

<%= div_toogle _('Summary'), 'menu_resume', :class => "menu_title" %>
<ul id="menu_resume">
  <% if @ingenieur and @request.socle and @request.socle.machine%>
     <li><b><%= _("Vm") %>: </b><%=h @request.socle.machine %></li>
  <% end %>
  <li><b><%= _("System") %>: </b><%= link_to_socle @request.socle %></li>
  <li><b><%= _("Software") %>: </b><%= link_to_request_software @request %></li>
  <li><b><%=_("Status")%>: </b>
       <%= link_to_box_on_status(@request) %> <%=help_on_status%></li>
  <li><b><%= _("Type")%>: </b><%= @request.typerequest.name %></li>
  <li><b><%= _("Severity")%>: </b>
       <%= @request.severite.name %> <%=help_on_severity%></li>
  <% unless @request.mail_cc.blank? %>
     <li><b><%= _('CC') %>: </b><%= @request.mail_cc.gsub(',', ',<br />') %></li>
  <% end %>
  <% submitter_id = @request.submitter_id %>
  <% if submitter_id != 0 && @request.recipient.user_id != submitter_id %>
    <li><b><%=_("Declared by")%>: </b><%= @request.submitter.name %></li>
  <% end %>
  <% if @request.ingenieur %>
    <li><b><%=_("Assigned to")%>: </b> <%= @request.ingenieur.name %> </li>
  <% end %>
</ul>

<%= div_toogle _('Recipent'), 'menu_recipient', :class => "menu_title" %>
<% user = @request.recipient.user %>
<ul id="menu_recipient">
  <li><b><%= _("Contact") %>: </b><%= mail_to(user.email, user.name)%>
     <%= link_to_show(account_path(user)) if @ingenieur %></li>
  <li><b><%= _('Phone') %>: </b><%= user.phone %></li>
  <% contract = @request.contract %>
  <li><b><%= _('Concerning') %>: </b><%= link_to contract, contract_path(contract) %></li>
</ul>

<%= div_toogle _("Life cycle"), 'life_cycle_menu', :class => "menu_title" %>
<ul id="life_cycle_menu">
  <li><b><%= _("Created on") %>: </b><%= @request.created_on_formatted %></li>
  <li><b><%= _("Updated on") %>: </b><%= @request.updated_on_formatted %></li>
  <% if @request.elapsed %>
     <li><b><%= _("Time elapsed") %>: </b><%= @request.elapsed_formatted %></li>
  <% end %>
  <% contribution = @request.contribution %>
  <% if contribution %>
    <li><%= link_to_request_contribution(contribution) %></li>
  <% end %>
</ul>

<%= div_toogle _("Help"), 'menu_help', :class => "menu_title" %>
<ul id="menu_help">
 <li><%= public_link_to_howto_request %></li>
</ul>

<% end # Cache %>
