<% options = { :update => 'content', :method => :get,
    :url => demandes_path,
    :before => "Element.show('spinner')",
    :success => "Element.hide('spinner')" } %>

<% form_remote_tag( options.dup.update(:html => {
    :id => 'filters', :name => 'filters'})) do %>

<%# used for iteration in ajaxified list %>
<%= hidden_field_tag 'page', '1' %>
<%# All request => 0, Active request => 1, Dead request => -1 %>
<%# see remote_link_to_(dead|active|all)_request in demandes_helper %>
<input id="filters_active" name="filters[active]" type="hidden" value="0" />

<div class="menu_title" onclick="Element.toggle('menu_actions')">>
<%=_('Actions')%></div>
<ul class="menu" id="menu_actions">
 <% path = new_demande_path %>
 <% if session[:user].authorized? path %>
   <li><%= link_to _("Submit a request"), path %></li>
 <% end %>
 <li><%= link_to _("Activity report"), general_reporting_path %></li>
 <li><%= requests_export_link %></li>
</ul>

<div class="menu_title" onclick="Element.toggle('menu_flux')">>
<%=_('Flow')%></div>
<ul class="menu" id="menu_flux">
  <li><%= remote_link_to_all_request %></li>
  <li><%= remote_link_to_active_request %></li>
  <li><%= remote_link_to_dead_request %></li>
</ul>

<div class="menu_title" onclick="Element.toggle('menu_recherche')">>
<%=_('Search')%></div>
<ul class="menu" id="menu_recherche">
 <li><b><%=_('By word')%></b><br />
     <%= text_field :filters, :text %></li>
 <% if @ingenieur %>
  <li><b><%=_('By contract')%></b><br />
      <%= select_filter(@contracts, :contract) %></li>
  <li><b><%=_('By expert')%></b><br />
  <%= select_filter(@ingenieurs, :ingenieur, { :first_value => @ingenieur, :first_name => _("[ Me ]") }) %></li>
 <% end %>
</ul>

<div class="menu_title" onclick="Element.toggle('menu_caracteristiques')">>
<%=_('Attributes')%></div>
<ul class="menu" id="menu_caracteristiques">
 <li><b><%=_('Type')%> </b><br />
     <%=select_filter(@typedemandes, :typedemande) %></li>
 <li><b><%=_('Severity')%></b><br />
     <%=select_filter(@severites, :severite) %></li>
 <li><b><%=_('Status')%></b><br />
     <%=select_filter(@statuts, :statut) %></li>
</ul>

<div class="menu_title" onclick="Element.toggle('menu_settings')">>
<%=_('Settings')%></div>
<ul class="menu" id="menu_settings" style="display: none">
 <li><b><%=_('Limit')%></b><br />
     <%= text_field :filters, :limit %></li>
</ul>

<div class="menu_title" onclick="Element.toggle('menu_aide')">
> <%= _("Help") %></div>
<ul class="menu" id="menu_aide">
 <li><%= public_link_to_help_new_request %></li>
 <li><%= public_link_to_howto_request %></li>
 <li><%= public_link_to_help_request_status %></li>
 <li><%= public_link_to_status_legend %></li>
</ul>
<%# mandatory for seeing last link ... :/ %>
<br />


<% end # form_remote %>

<%= observe_form 'filters', options %>
