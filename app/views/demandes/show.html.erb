<%############ infos demandes #########################
  # require : @demande, @contributions, @count
  #           @users_ingenieurs
%>
<%# It's separated by roles, since viewer & customer see different things %>
<% cache("requests/#{@demande.id}/front-#{session[:user].role_id}") do %>
 <div class="content">
   <% if @demande.logiciel %>
     <div style="float: right">
        <%= public_link_to(software_logo(@demande.logiciel),
	                       logiciel_path(@demande.logiciel)) %>
     </div>
   <% end %>
   <h1>
    <% options = edit_demande_path(@demande.id) %>
    <%= link_to(StaticImage::edit, options) %>
    <%= "[#{sprintf "%06d", @demande.id}] #{@demande.resume}" %>
    <% options = print_demande_path(@demande.id) %>
    <%= link_to(StaticImage::print, options) %>
   </h1>

   <%= render(:partial => 'demandes/tabs/comment', :locals =>
         { :comment => @last_commentaire }) %>

   <div>
    <% if session[:user].authorized? "commentaires/comment" %>
     <% action = comment_commentaire_path(@demande) %>
     <% form_tag(action, :method => :post, :multipart => true) do %>
      <%= render :partial => 'comment_form' %>
      <p>&nbsp;</p>
     <% end %>
    <% end %>
   </div>

   <%# see tab_menu for ajax links %>
   <div class="demande_tab" id="demande_tab">
    <%= render :partial => 'demandes/tabs/tab_description' %>
   </div>
 </div>
<% end %>
