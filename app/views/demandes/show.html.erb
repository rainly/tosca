<% ############ infos demandes #########################
   # require : @demande, @contributions, @count
   #           @users_ingenieurs
%>

<% cache("requests/#{@demande.id}/up-comment-#{session[:user].kind}") do %>
 <div class="content">
   <h1>
    <% options = edit_demande_path(@demande.id) %>
    <% html_options = { :class => 'no_hover' } %>
    <%= link_to(StaticImage::edit, options, html_options) %>
    <%= "[#{sprintf "%06d", @demande.id}] #{@demande.resume}" %>
    <% options = print_demande_path(@demande.id) %>
    <%= link_to(StaticImage::print, options, html_options) %>
   </h1>

   <%= render(:partial => 'demandes/tabs/comment', :locals =>
         { :comment => @last_commentaire }) %>
<% end %>

    <% #NO CACHE because we use sessions variables %>
   <div>
    <% if session[:user].authorized? "commentaires/comment" %>
     <% action = comment_commentaire_path(@demande) %>
     <% form_tag(action, :method => :post, :multipart => true) do %>
      <%= render :partial => 'comment_form' %>
      <p>&nbsp;</p>
     <% end %>
    <% end %>
   </div>

<% cache("requests/#{@demande.id}/tab-#{session[:user].kind}") do %>
   <%# see tab_menu for ajax links %>
   <div class="demande_tab" id="demande_tab">
    <%= render :partial => 'demandes/tabs/tab_description' %>
   </div>
 </div>
<% end %>
